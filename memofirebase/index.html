<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å ±ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
</head>
<body>
<main>
    <div class="contents">
        <!-- sidebar sectionã€€ä½ç½®ã¯å·¦ -->
        <div class="sidebar">
            <header>All Notes</header>
            <!-- <div class="search_area"></div>
                    <input type="search" placeholder="æ¤œç´¢" name="" id=""> -->
            <!-- id:allnoteã«ã©ã‚“ã©ã‚“è¿½åŠ ã•ã‚Œã‚‹ã€‚ -->
            <ul id="allnote">
                <!-- <li>
                        ã“ã“ã«è¿½åŠ ã•ã‚Œã¦ã„ã
                    </li> -->
            </ul>
        </div>
        <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã€€ä½ç½®ã¯å³ -->
        <div class="note">
            <header class="noteheader">
                <a href="" class="iconleft"><i class="fa-thin fa-circle-info"></i></a>
                <a href="" class="iconright"><i class="fa-thin fa-circle-info"></i></a>
                <a href="" class="iconright"><i class="fa-thin fa-circle-info"></i></a>
                <a href="" class="iconright"><i class="fa-thin fa-circle-ellipsis-vertical"></i></a>
            </header>
            <!-- <div class="text"> -->
            <input type="text" id="title" placeholder="ãƒ¡ãƒ¢ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚">
            <textarea id="text" placeholder="æœ¬æ–‡ã‚’å…¥ã‚Œã¦ãã ã•ã„"></textarea>
            <ul>
                <li id="save" class="savebutton">Save</li>
                <li id="clear" class="clearbutton">Clear</li>
            </ul>
            <!-- </div> -->
        </div>
    </div>
</main>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="js/memo.js"></script>
<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    // è²¼ã‚Šä»˜ã‘ã‚‹å ´æ‰€
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    // 
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBkZ30CD9uSmEIBDb2E_g-PE82X3dmug-M",
        authDomain: "memo-6e87e.firebaseapp.com",
        projectId: "memo-6e87e",
        storageBucket: "memo-6e87e.appspot.com",
        messagingSenderId: "71702411569",
        appId: "1:71702411569:web:17896c9a279834f8d19810"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // ã“ã®è¾ºã‚Šã«æ›¸ã„ã¦ã„ãã¾ã™
    const db = getDatabase(app);
    const dbRef = ref(db, "memo");


    // é€ä¿¡å‡¦ç†ã‚’è¨˜è¿°
    $('#save').on('click', function () {
        // id="key"ã¨"memo"" ã®å ´æ‰€ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
        const title = $('#title').val();
        const text = $('#text').val();
        // ç©ºç™½ã‚’ãƒã‚§ãƒƒã‚¯
        if (!title) {
            alert('ã‚¿ã‚¤ãƒˆãƒ«ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
            return false;
        }
        if (!text) {
            alert('æœ¬æ–‡ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
            return false;
        }
        const msg = {
            title: title,
            text: text,
        }
        // firebaseã«é€ã‚‹æº–å‚™ã‚’ã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ğŸ¤—
        const newPostRef = push(dbRef) //ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã‚‹æº–å‚™
        set(newPostRef, msg); // firebaseã®ç™»éŒ²ã§ãã‚‹å ´æ‰€ã«ä¿å­˜ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤—
    });
    // $("#text").on('keydown', function (e) {
    //     console.log(e, 'ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã®å¡Š')
    //     console.log(e.keyCode, 'ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã®å¡Š')
    //     // ã“ã®ä¸‹æ¶ˆã•ãªã„ã€€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’æŠ¼ã—ãŸæ™‚ã®ã‚¯ãƒªãƒƒã‚¯
    // });

    // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
    onChildAdded(dbRef, function (data) {
        // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™

        // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
        const msg = data.val();
        console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
        const key = data.key;
        console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')
        // es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
        let html =
            `
                <li id=${key}>${msg.title}
                <p id=${msg.text}>${msg.text}</p>
                <p id=${key} class=delete>Ã—</p>
                </li>
                `;
        // htmlã«åŸ‹ã‚è¾¼ã¿ã¾ã—ã‚‡ã†ğŸ¤—
        // append();ã¨ã„ã†jqueryã®ãŠã¾ã˜ãªã„ã‚’ä½¿ã„ã¾ã™
        $("#allnote").append(html);
    });
    
    //ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´æ‰€ã®IDã‚’å–å¾—ã—ã¦ã€ç”»é¢ã«è¡¨ç¤ºã™ã‚‹
    function addlist() {
        $('#allnote li').on('click', function () {
            let id_name = $(this).attr('id');
            console.log(id_name, "idå–å¾—ã§ãã¦ã„ã‚‹ã‹")
            // console.log(text, "textå–å¾—ã§ãã¦ã„ã‚‹ã‹")
            // $("#title").val(text);
            // $("#text").val(id_name);     
        });
    };
    addlist()


    $('.delete').on('click', function () {
    const value=$(this).attr("id");   
    console.log(value,"å†…å®¹ã‚’å–å¾—")
        ref.Child(value).Remove();
    })

</script>
</body>
</html>